## HTTP的原理

### HTTP协议

HTTP是一个无状态的协议，也叫超文本传输协议；无状态是指客户端和服务器之间不需要建立连接，在一个客户端向服务器端发出请求且服务器收到请求并返回响应后，通信结束，然后HTTP连接关闭。HTTP请求遵循请求/应答模型，客户端向服务器发送请求，服务器处理请求并返回适当的应答。

### HTTP传输流程

HTTP传输流程包括：地址解析、封装HTTP数据包、封装TCP包、建立TCP连接、客户端发送请求、服务端响应、服务端关闭TCP连接七个过程。

1、地址解析：通过域名系统DNS解析服务器域名获取到IP地址；

2、封装HTTP数据包：解析协议名、主机名、端口、对象路径等结合本机的信息封装成一个HTTP请求数据包；

3、封装TCP包：将HTTP请求数据包进一步封装成TCP数据包；

4、建立TCP连接：基于TCP的三次握手机制建立TCP连接；

5、客户端发送请求：建立连接后，客户端发送一个请求给服务器；

6、服务端响应：服务器收到请求后，进行业务数据处理，然后向客户端返回相应的响应信息；响应信息中包含状态行、协议版本号、状态码、消息体等内容；

7、服务端关闭TCP连接：服务器向浏览器发送请求响应数据后关闭TCP连接。

### HTTP报文结构

#### 请求报文

从客户端向服务器发送请求报文

![http-req-message](http://pwoodong.gitee.io/blog/img/202103/http-req-message.png)

报文由三个部分组成：开始行、首部行、实体主体；

请求报文的一些方法：

| 方法(操作) | 意义                            |
| :--------- | ------------------------------- |
| OPTION     | 请求一些选项的信息              |
| GET        | 请求读取由URL所标志的信息       |
| HEAD       | 请求读取由URL所标志的信息的首部 |
| POST       | 给服务器添加信息                |
| PUT        | 在指明的URL下存储一个文档       |
| DELETE     | 删除指明的URL所标志的资源       |
| TRACE      | 用来进行环回测试的请求报文      |
| CONNECT    | 用于代理服务器                  |

#### 响应报文

从服务器到客户的回答

![http-res-message](http://pwoodong.gitee.io/blog/img/202103/http-res-message.png)

响应报文开始行是状态行，状态行包括：HTTP的版本、状态码、解释状态码的简单短语；

状态码：

| 状态码 | 描述                                             |
| ------ | ------------------------------------------------ |
| 1xx    | 表示通知信息的，如请求收到了或正在进行处理       |
| 2xx    | 表示成功，如接受或知道了                         |
| 3xx    | 表示重定向，表示要完成请求还必须采取进一步的行动 |
| 4xx    | 表示客户的差错，如请求中有错误的语法或不能完成   |
| 5xx    | 表示服务器的差错，如服务器失效无法完成请求       |

### HTTPS原理

HTTPS是以安全为目标的HTTP通道，它在HTTP中加入SSL层以提高数据传输的安全性，又叫安全套接字层超文本传输协议；SSL是依靠证书来验证服务器的身份，并对浏览器和服务器之间的通信进行数据加密，以保障数据传输的安全性，端口一般是443。

HTTPS的加密流程：

1、发起请求：客户端通过TCP和服务器建立连接后，发送一个请求证书的消息给服务器，在该请求消息里包含自己实现的算法列表和其它需要的消息；

2、证书返回：服务器在收到消息后回应客户端并返回证书，在证书中包含服务器信息、域名、申请证书的公司、公钥、数据加密算法等；

3、证书验证：客户端在收到证书后，判断证书签发机构是否正确，并使用该签发机构的公钥确认签名是否有效，客户端还会确保在证书列出的域名为正在连接的域名，客户端确认证书有效后，则生成对称密钥，并使用公钥将对称密钥加密；

4、密钥交换：客户端将加密后的对称密钥发给服务器，服务器在接收到对称密钥后使用私钥解密；

5、数据传输：经过上述步骤，客户端和服务器就完成了密钥对的交换，在之后的数据传输过程中，客户端和服务器就可以基于对称加密将数据加密后在网络上传输，保证了网络数据传输的安全性。

